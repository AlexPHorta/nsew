<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>NSEW keyboard tests</title>
  <link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.9.2.css">
  <script src="https://code.jquery.com/qunit/qunit-2.9.2.js"></script>

  <script src="keyboard.js"></script>
  <script src="conf.js"></script>

  <script>

    var gridConf;

    QUnit.todo("Keyboard Grid needs an Array", function(assert) {
        gridConf = "XXX";
        assert.raises(makeGrid(gridConf), new Error("Feed me an Array!"),
                "Not an array is an error.");
    });

    QUnit.test("Keyboard Grid, if the argument is Array", function(assert) {
        gridConf = [];
        assert.equal(makeGrid(gridConf), "<table></table>",
                "An empty array makes an empty table.");
        gridConf = [""];
        assert.equal(makeGrid(gridConf), "<table><tr></tr></table>",
                "An empty item makes an empty row.");
    });
    
    QUnit.test("Keyboard Grid, creating cells", function(assert) {
        gridConf = ["-"];
        assert.equal(makeGrid(gridConf), "<table><tr><td></td></tr></table>",
                "A dash creates a cell.");
        gridConf = ["--"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="2"></td></tr></table>',
                "Dashes indicate the number of merged columns");
        gridConf = ["---", "---", "---"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="3"></td></tr>' + 
                '<tr><td colspan="3"></td></tr><tr><td colspan="3"></td>' +
                '</tr></table>',
                "The number of items is the number of rows");
        gridConf = ["***", "---"];
        assert.equal(makeGrid(gridConf), '<table><tr><td></td><td></td>' +
                '<td></td></tr><tr><td colspan="3"></td></tr></table>',
                "Stars make single table cells");
    });

    QUnit.test("Keyboard Grid, mixing cells", function(assert) {
        gridConf = ["---*---"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="3"></td>' +
                '<td></td><td colspan="3"></td></tr></table>',
                "Dashes and stars");
        gridConf = ["*--*--*"];
        assert.equal(makeGrid(gridConf), '<table><tr><td></td><td colspan="2"></td>' +
            '<td></td><td colspan="2"></td><td></td></tr></table>',
               "Dashes, and more stars");
        gridConf = ["---0---"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="3"></td>' +
                '<td id="0" class="key"></td><td colspan="3"></td></tr></table>',
               "Dashes, and a zero");
        gridConf = ["---0---", "--1-2--", "-3---4-"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="3"></td>' +
                '<td id="0" class="key"></td><td colspan="3"></td></tr>' +
                '<tr><td colspan="2"></td><td id="1" class="key"></td>' +
                '<td></td><td id="2" class="key"></td><td colspan="2"></td></tr>' +
                '<tr><td></td><td id="3" class="key"></td><td colspan="3"></td>' +
                '<td id="4" class="key"></td><td></td></tr></table>',
                "Dashes, and numbers, a more complex example");
        gridConf = ["---0---", "-1_-2_-", "-3_-4_-"];
        assert.equal(makeGrid(gridConf), '<table><tr><td colspan="3"></td>' +
                '<td id="0" class="key"></td><td colspan="3"></td></tr>' +
                '<tr><td></td><td id="1" class="key" colspan="2"></td><td></td>' +
                '<td id="2" class="key" colspan="2"></td><td></td></tr>' +
                '<tr><td></td><td id="3" class="key" colspan="2"></td><td></td>' +
                '<td id="4" class="key" colspan="2"></td><td></td></tr></table>', 
                "Underscores make a numbered cell span multiple columns");
    });

    QUnit.test("Keys list generator", function(assert) {
        gridConf = kbdGrid;
        assert.equal(genKbdKeys(gridConf), "0123456789abcdefghijklmnopqrst",
                "Generate the list of keys.");
    });

    QUnit.test("Generate cursor walk paths", function(assert) {
        gridConf = kbdGrid;
        let paths = [[4, 28, 26, 27], [12, 5, 13, 26], [26, 14, 6, 15],
                    [17, 26, 16, 7], [8, 29, 0, 29],  [18, 9, 19, 1],
                    [2, 20, 10, 21], [23, 3, 22, 11], [10, -1, 4, -1],
                    [-1, 11, -1, 5], [6, 24, 8, 25],  [-1, 7, -1, 9],
                    [28, 18, 1, 26], [1, 19, -1, 26], [26, 15, 20, 2],
                    [26, 2, 21, 14], [3, 26, -1, 22], [27, 26, 3, 23],
                    [28, 23, 5, 12], [5, 22, 18, 13], [14, 21, 24, 6],
                    [15, 6, 25, 20], [7, 16, 23, 19], [22, 17, 7, 18],
                    [20, 25, 29, 10],[21, 10, 27, 24],[0, 1, 2, 3],
                    [25, 0, 26, 28], [29, 27, 26, 0], [24, 4, 28, 4]];
        assert.equal(genCursorWalkPaths(gridConf), paths,
                "Generate the cursor walk paths.");
    });
  </script>
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
</body>
</html>
